<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gmail + Google Drive Инструменты</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      background: #fcf4ab;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .lang-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .lang-selector button {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      border: none;
      background-color: #fff;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .lang-selector img {
      width: 20px;
      height: 14px;
    }

    .tool {
      background: white;
      width: 100%;
      max-width: 600px;
      margin: 20px 0;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    h2 {
      margin-top: 0;
      text-align: center;
      color: #333;
    }

    input[type="text"],
    textarea {
      padding: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 15px;
      width: 100%;
    }

    input.invalid {
      border-color: red;
    }

    .error-message {
      color: red;
      font-size: 14px;
      margin-top: -10px;
      margin-bottom: 10px;
    }

    textarea {
      background: #f9f9f9;
      resize: none;
      height: 220px;
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .button-row button {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      background: #000;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .button-row button:hover {
      background: #333;
    }

    .email-counter {
      background: #e0f7fa;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    @media (max-width: 600px) {
      .button-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="lang-selector">
    <button onclick="setLanguage('ru')"><img src="https://flagcdn.com/w40/ru.png" alt="RU">RU</button>
    <button onclick="setLanguage('en')"><img src="https://flagcdn.com/w40/us.png" alt="EN">EN</button>
    <button onclick="setLanguage('es')"><img src="https://flagcdn.com/w40/es.png" alt="ES">ES</button>
  </div>

  <!-- Gmail Tool -->
  <div class="tool">
    <h2 id="gmailTitle">Вариации почты Gmail</h2>
    <input type="text" id="emailInput" placeholder="Введите Gmail адрес, например dokyt56fg78@gmail.com" oninput="validateEmail()">
    <div id="emailError" class="error-message" style="display:none"></div>
    <div id="emailCounter" class="email-counter">Вариаций: 0</div>
    <div class="button-row">
      <button onclick="generateGmailVariations()" id="generateBtn">Сгенерировать</button>
      <button onclick="copyGmail()" id="copyBtn">Скопировать всё</button>
      <button onclick="downloadGmail()" id="downloadTxtBtn">Скачать .txt</button>
      <button onclick="downloadCSV()" id="downloadCsvBtn">Экспорт в CSV</button>
    </div>
    <textarea id="gmailOutput" placeholder="Здесь появятся варианты..." readonly></textarea>
  </div>

  <!-- Google Drive Tool -->
  <div class="tool">
    <h2 id="driveTitle">Прямая ссылка Google Диска</h2>
    <input type="text" id="driveInput" placeholder="Вставьте ссылку на файл в Google Диске">
    <div class="button-row">
      <button onclick="convertDriveLink()" id="convertBtn">Преобразовать</button>
      <button onclick="copyDrive()" id="copyDriveBtn">Скопировать ссылку</button>
      <button onclick="goToDriveLink()" id="goToLinkBtn">Перейти по ссылке</button>
      <button onclick="shortenDriveLink()" id="shortenLinkBtn">Укоротить ссылку</button>
    </div>
    <textarea id="driveOutput" placeholder="Прямая ссылка для скачивания" readonly></textarea>
  </div>

  <!-- T.LY Shortener Tool -->
  <div class="tool">
    <h2 id="tlyTitle">Укорачивание ссылок через T.LY</h2>
    <input type="text" id="tlyInput" placeholder="Вставьте любую ссылку для укорачивания">
    <div class="button-row">
      <button onclick="shortenTLYLink()" id="shortenTLYBtn">Укоротить</button>
      <button onclick="copyTLY()" id="copyTLYBtn">Скопировать</button>
    </div>
    <textarea id="tlyOutput" placeholder="Укороченная ссылка появится здесь..." readonly></textarea>
  </div>

  <script>
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }

    const translations = {
      ru: {
        gmailTitle: "Вариации почты Gmail",
        generateBtn: "Сгенерировать",
        copyBtn: "Скопировать всё",
        downloadTxtBtn: "Скачать .txt",
        downloadCsvBtn: "Экспорт в CSV",
        driveTitle: "Прямая ссылка Google Диска",
        convertBtn: "Преобразовать",
        copyDriveBtn: "Скопировать ссылку",
        goToLinkBtn: "Перейти по ссылке",
        shortenLinkBtn: "Укоротить ссылку",
        tlyTitle: "Укорачивание ссылок через T.LY",
        shortenTLYBtn: "Укоротить",
        copyTLYBtn: "Скопировать",
        emailCounter: "Вариаций: ",
        emailInputPlaceholder: "Введите Gmail адрес, например dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Здесь появятся варианты...",
        driveInputPlaceholder: "Вставьте ссылку на файл в Google Диске",
        driveOutputPlaceholder: "Прямая ссылка для скачивания",
        tlyInputPlaceholder: "Вставьте любую ссылку для укорачивания",
        tlyOutputPlaceholder: "Укороченная ссылка появится здесь...",
        copySuccess: "Скопировано!",
        copyError: "Ошибка копирования: ",
        invalidEmailError: "Некорректный Gmail адрес",
        noGmailDataError: "Нет данных для сохранения.",
        noGmailExportError: "Нет данных для экспорта.",
        invalidDriveLinkError: "Не удалось извлечь ID файла. Проверьте правильность ссылки.",
        noDriveLinkError: "Нет ссылки для перехода. Сначала преобразуйте ссылку.",
        noLinkToShortenError: "Нет ссылки для укорачивания. Сначала преобразуйте ссылку.",
        noTLYLinkError: "Введите ссылку для укорачивания.",
        shortenLinkError: "Ошибка при укорачивании ссылки. Проверьте API-ключ или обратитесь в поддержку T.LY."
      },
      en: {
        gmailTitle: "Gmail Address Variations",
        generateBtn: "Generate",
        copyBtn: "Copy All",
        downloadTxtBtn: "Download .txt",
        downloadCsvBtn: "Export to CSV",
        driveTitle: "Direct Google Drive Link",
        convertBtn: "Convert",
        copyDriveBtn: "Copy Link",
        goToLinkBtn: "Go to Link",
        shortenLinkBtn: "Shorten Link",
        tlyTitle: "Shorten Links via T.LY",
        shortenTLYBtn: "Shorten",
        copyTLYBtn: "Copy",
        emailCounter: "Variations: ",
        emailInputPlaceholder: "Enter Gmail address, e.g., dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Variations will appear here...",
        driveInputPlaceholder: "Paste the Google Drive file link",
        driveOutputPlaceholder: "Direct download link",
        tlyInputPlaceholder: "Paste any link to shorten",
        tlyOutputPlaceholder: "Shortened link will appear here...",
        copySuccess: "Copied!",
        copyError: "Copy error: ",
        invalidEmailError: "Invalid Gmail address",
        noGmailDataError: "No data to save.",
        noGmailExportError: "No data to export.",
        invalidDriveLinkError: "Failed to extract file ID. Check the link.",
        noDriveLinkError: "No link to navigate to. Convert the link first.",
        noLinkToShortenError: "No link to shorten. Convert the link first.",
        noTLYLinkError: "Enter a link to shorten.",
        shortenLinkError: "Error shortening link. Check the API key or contact T.LY support."
      },
      es: {
        gmailTitle: "Variaciones de Gmail",
        generateBtn: "Generar",
        copyBtn: "Copiar todo",
        downloadTxtBtn: "Descargar .txt",
        downloadCsvBtn: "Exportar a CSV",
        driveTitle: "Enlace directo de Google Drive",
        convertBtn: "Convertir",
        copyDriveBtn: "Copiar enlace",
        goToLinkBtn: "Ir al enlace",
        shortenLinkBtn: "Acortar enlace",
        tlyTitle: "Acortar enlaces con T.LY",
        shortenTLYBtn: "Acortar",
        copyTLYBtn: "Copiar",
        emailCounter: "Variaciones: ",
        emailInputPlaceholder: "Ingrese la dirección de Gmail, por ejemplo, dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Las variaciones aparecerán aquí...",
        driveInputPlaceholder: "Pegue el enlace del archivo de Google Drive",
        driveOutputPlaceholder: "Enlace de descarga directa",
        tlyInputPlaceholder: "Pegue cualquier enlace para acortar",
        tlyOutputPlaceholder: "El enlace acortado aparecerá aquí...",
        copySuccess: "¡Copiado!",
        copyError: "Error al copiar: ",
        invalidEmailError: "Dirección de Gmail no válida",
        noGmailDataError: "No hay datos para guardar.",
        noGmailExportError: "No hay datos para exportar.",
        invalidDriveLinkError: "No se pudo extraer el ID del archivo. Verifique el enlace.",
        noDriveLinkError: "No hay enlace para navegar. Convierta el enlace primero.",
        noLinkToShortenError: "No hay enlace para acortar. Convierta el enlace primero.",
        noTLYLinkError: "Ingrese un enlace para acortar.",
        shortenLinkError: "Error al acortar el enlace. Verifique la clave API o contacte con el soporte de T.LY."
      }
    };

    function setLanguage(lang) {
      document.documentElement.lang = lang;
      const t = translations[lang];
      document.getElementById("gmailTitle").innerText = t.gmailTitle;
      document.getElementById("generateBtn").innerText = t.generateBtn;
      document.getElementById("copyBtn").innerText = t.copyBtn;
      document.getElementById("downloadTxtBtn").innerText = t.downloadTxtBtn;
      document.getElementById("downloadCsvBtn").innerText = t.downloadCsvBtn;
      document.getElementById("driveTitle").innerText = t.driveTitle;
      document.getElementById("convertBtn").innerText = t.convertBtn;
      document.getElementById("copyDriveBtn").innerText = t.copyDriveBtn;
      document.getElementById("goToLinkBtn").innerText = t.goToLinkBtn;
      document.getElementById("shortenLinkBtn").innerText = t.shortenLinkBtn;
      document.getElementById("tlyTitle").innerText = t.tlyTitle;
      document.getElementById("shortenTLYBtn").innerText = t.shortenTLYBtn;
      document.getElementById("copyTLYBtn").innerText = t.copyTLYBtn;
      document.getElementById("emailCounter").innerText = t.emailCounter + document.getElementById("gmailOutput").value.split('\n').filter(Boolean).length;
      document.getElementById("emailInput").placeholder = t.emailInputPlaceholder;
      document.getElementById("gmailOutput").placeholder = t.gmailOutputPlaceholder;
      document.getElementById("driveInput").placeholder = t.driveInputPlaceholder;
      document.getElementById("driveOutput").placeholder = t.driveOutputPlaceholder;
      document.getElementById("tlyInput").placeholder = t.tlyInputPlaceholder;
      document.getElementById("tlyOutput").placeholder = t.tlyOutputPlaceholder;
    }

    async function copyToClipboard(text) {
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      try {
        await navigator.clipboard.writeText(text);
        alert(t.copySuccess);
      } catch (err) {
        alert(t.copyError + err);
      }
    }

    function validateEmail() {
      const emailField = document.getElementById("emailInput");
      const errorField = document.getElementById("emailError");
      const email = emailField.value.trim();
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      const isValid = /^[a-zA-Z0-9]+(\.?[a-zA-Z0-9]+)*@gmail\.com$/.test(email);
      if (email && !isValid) {
        emailField.classList.add("invalid");
        errorField.style.display = "block";
        errorField.innerText = t.invalidEmailError;
      } else {
        emailField.classList.remove("invalid");
        errorField.style.display = "none";
      }
    }

    function generateGmailVariations() {
      const email = document.getElementById("emailInput").value.trim().toLowerCase();
      const output = document.getElementById("gmailOutput");
      const counter = document.getElementById("emailCounter");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      output.value = "";

      if (!/^[a-zA-Z0-9]+(\.?[a-zA-Z0-9]+)*@gmail\.com$/.test(email)) {
        validateEmail();
        counter.innerText = t.emailCounter + "0";
        return;
      }

      const [local, domain] = email.split("@");
      const variations = new Set();
      const positions = [];

      for (let i = 1; i < local.length; i++) positions.push(i);

      const totalCombos = Math.pow(2, positions.length);

      for (let i = 0; i < totalCombos; i++) {
        let parts = [], last = 0;
        for (let j = 0; j < positions.length; j++) {
          if (i & (1 << j)) {
            parts.push(local.slice(last, positions[j]));
            last = positions[j];
          }
        }
        parts.push(local.slice(last));
        const dotted = parts.join(".");
        if (/^(?!\.).*(?<!\.)$/.test(dotted) && !dotted.includes("..")) {
          variations.add(dotted + "@gmail.com");
          variations.add(dotted + "@googlemail.com");
        }
      }

      const variationList = Array.from(variations).sort();
      output.value = variationList.join("\n");
      counter.innerText = t.emailCounter + variationList.length;
    }

    function copyGmail() {
      const text = document.getElementById("gmailOutput").value;
      copyToClipboard(text);
    }

    function downloadTextFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function downloadGmail() {
      const text = document.getElementById("gmailOutput").value;
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!text.trim()) {
        alert(t.noGmailDataError);
        return;
      }
      downloadTextFile("gmail_variations.txt", text);
    }

    function downloadCSV() {
      const text = document.getElementById("gmailOutput").value;
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!text.trim()) {
        alert(t.noGmailExportError);
        return;
      }
      const lines = text.split('\n').filter(Boolean);
      const csvContent = "data:text/csv;charset=utf-8," + lines.map(line => `"${line}"`).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "gmail_variations.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function convertDriveLink() {
      const input = document.getElementById("driveInput").value.trim();
      const output = document.getElementById("driveOutput");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      const match = input.match(/(?:\/d\/|id=|\/file\/d\/)([a-zA-Z0-9_-]{10,})/);
      if (match && match[1]) {
        const fileId = match[1];
        output.value = `https://drive.google.com/uc?export=download&id=${fileId}`;
      } else {
        output.value = "";
        alert(t.invalidDriveLinkError);
      }
    }

    function copyDrive() {
      const text = document.getElementById("driveOutput").value;
      copyToClipboard(text);
    }

    function goToDriveLink() {
      const link = document.getElementById("driveOutput").value.trim();
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (link) {
        window.open(link, '_blank');
      } else {
        alert(t.noDriveLinkError);
      }
    }

    async function shortenDriveLink() {
      const link = document.getElementById("driveOutput").value.trim();
      const output = document.getElementById("driveOutput");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!link) {
        alert(t.noLinkToShortenError);
        return;
      }

      const apiKey = "Bearer RUqLv6yD7jSQIzEpmFjwTW9l440Q2H6LbTKuTq6J9cY0ZPwaTUw2tbcgLmeC";
      const apiUrl = "https://t.ly/api/v1/link/shorten";

      console.log("=== Начало укорачивания ссылки (Google Drive) ===");
      console.log("Ссылка:", link);
      console.log("API-ключ:", apiKey);
      console.log("Эндпоинт:", apiUrl);

      try {
        const online = navigator.onLine;
        if (!online) {
          throw new Error("Нет подключения к интернету. Проверьте сеть.");
        }

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Authorization": apiKey,
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({
            long_url: link,
            domain: "https://t.ly/",
            include_qr_code: false
          })
        });

        console.log("Статус ответа:", response.status);
        console.log("Заголовки ответа:", [...response.headers.entries()]);

        if (!response.ok) {
          const errorText = await response.text();
          console.error("Детали ошибки от API:", errorText);
          throw new Error(`Status: ${response.status}, Details: ${errorText}`);
        }

        const data = await response.json();
        console.log("Успешный ответ:", data);
        output.value = data.short_url;
      } catch (error) {
        console.error("Ошибка укорачивания ссылки:", error);
        alert(`Ошибка API: ${error.message}`);
      } finally {
        console.log("=== Конец укорачивания ссылки (Google Drive) ===");
      }
    }

    async function shortenTLYLink() {
      const link = document.getElementById("tlyInput").value.trim();
      const output = document.getElementById("tlyOutput");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!link) {
        alert(t.noTLYLinkError);
        return;
      }

      const apiKey = "Bearer RUqLv6yD7jSQIzEpmFjwTW9l440Q2H6LbTKuTq6J9cY0ZPwaTUw2tbcgLmeC";
      const apiUrl = "https://t.ly/api/v1/link/shorten";

      console.log("=== Начало укорачивания ссылки (T.LY) ===");
      console.log("Ссылка:", link);
      console.log("API-ключ:", apiKey);
      console.log("Эндпоинт:", apiUrl);

      try {
        const online = navigator.onLine;
        if (!online) {
          throw new Error("Нет подключения к интернету. Проверьте сеть.");
        }

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Authorization": apiKey,
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({
            long_url: link,
            domain: "https://t.ly/",
            include_qr_code: false
          })
        });

        console.log("Статус ответа:", response.status);
        console.log("Заголовки ответа:", [...response.headers.entries()]);

        if (!response.ok) {
          const errorText = await response.text();
          console.error("Детали ошибки от API:", errorText);
          throw new Error(`Status: ${response.status}, Details: ${errorText}`);
        }

        const data = await response.json();
        console.log("Успешный ответ:", data);
        output.value = data.short_url;
      } catch (error) {
        console.error("Ошибка укорачивания ссылки:", error);
        alert(`Ошибка API: ${error.message}`);
      } finally {
        console.log("=== Конец укорачивания ссылки (T.LY) ===");
      }
    }

    function copyTLY() {
      const text = document.getElementById("tlyOutput").value;
      copyToClipboard(text);
    }
  </script>
</body>
</html>
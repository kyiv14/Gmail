<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Инструменты Google</title>
  <style>
    /* VARIABLES */
    :root {
      --primary-color: #dc2625; /* Red-700 */
      --secondary-color: #ffffff;
      --background-color: #f5f5f7; 
      --text-color: #1d1d1f;
      --border-color: #e3e3e3; 
      --shadow-color: rgba(0, 0, 0, 0.05);
      --transition-duration: 0.2s;
    }

    /* BASE STYLES */
    * { 
      box-sizing: border-box; 
      font-family: 'SF Pro Text', 'SF Pro Icons', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
    }

    body {
      margin: 0;
      padding: 30px 20px;
      background: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      line-height: 1.5;
    }

    h2 {
      margin-top: 0;
      font-size: 20px; /* Уменьшен размер заголовка для узких колонок */
      font-weight: 600; 
      text-align: center;
      color: var(--text-color);
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    /* LANGUAGE SELECTOR */
    .lang-selector {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      justify-content: center;
    }

    .lang-selector button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      background-color: var(--secondary-color);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      box-shadow: 0 1px 3px var(--shadow-color);
      transition: all var(--transition-duration) ease;
    }

    .lang-selector button:hover {
      border-color: var(--primary-color);
      box-shadow: 0 2px 8px var(--shadow-color);
    }
    
    .lang-selector button:active {
      transform: scale(0.98); 
    }

    .lang-selector img {
      width: 20px;
      height: 14px;
      border-radius: 2px;
    }

    /* MAIN CONTENT CONTAINER for Horizontal Layout */
    .tool-container {
        display: flex;
        gap: 20px; /* Расстояние между окнами */
        width: 100%;
        max-width: 700px; /* Общая максимальная ширина для двух окон (2*320 + gap) */
        justify-content: center;
        flex-wrap: wrap; /* Позволяет окнам переноситься на новую строку на маленьких экранах */
    }

    /* TOOL CARD (ОКНО) */
    .tool {
      background: var(--secondary-color);
      /* Фиксированная ширина для горизонтального размещения */
      width: 100%; 
      max-width: 320px; 
      margin: 10px 0; /* Убраны вертикальные отступы внутри контейнера */
      padding: 25px; /* Немного уменьшены внутренние отступы */
      border-radius: 18px; 
      box-shadow: 0 4px 12px var(--shadow-color), 0 1px 3px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease; 
    }
    
    .tool:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    /* INPUTS & TEXTAREAS */
    input[type="text"],
    textarea {
      padding: 12px 15px; /* Немного уменьшены отступы */
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 15px;
      margin-bottom: 15px;
      width: 100%;
      color: var(--text-color);
      background: var(--secondary-color);
      transition: border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
    }

    input[type="text"]:focus,
    textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(220, 38, 37, 0.15); 
    }

    .error-message {
      color: var(--primary-color);
      font-size: 13px; /* Немного уменьшен размер шрифта */
      margin-top: -10px;
      margin-bottom: 15px;
      font-weight: 500;
    }

    textarea {
      background: #fcfcfc;
      resize: vertical; 
      height: 150px; /* Уменьшена высота по умолчанию */
      min-height: 80px;
    }
    
    /* BUTTONS */
    .button-row {
      display: flex;
      flex-direction: column; /* Кнопки всегда вертикально для узких колонок */
      gap: 8px; 
      margin-bottom: 15px;
    }

    .button-row button {
      flex: 1;
      width: 100%; 
      padding: 14px 12px; /* Отступы для центрирования и удобства */
      text-align: center; 
      font-size: 15px; /* Немного уменьшен размер шрифта */
      font-weight: 600;
      color: var(--secondary-color);
      background: var(--primary-color);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(220, 38, 37, 0.2);
      transition: all var(--transition-duration) ease;
    }
    
    /* Secondary Button Style */
    .button-row button:not(:first-child) {
      background: #e9e9e9; 
      color: var(--text-color);
      box-shadow: none;
    }

    .button-row button:hover {
      opacity: 0.9;
      transform: translateY(-1px); 
    }
    
    .button-row button:active {
      transform: translateY(1px) scale(0.99); 
      box-shadow: 0 1px 2px rgba(220, 38, 37, 0.2);
    }
    
    /* Secondary Button Hover/Active */
    .button-row button:not(:first-child):hover {
      background: #d8d8d8;
      opacity: 1;
    }

    /* EMAIL COUNTER */
    .email-counter {
      background: #f7f7f9; 
      padding: 10px; /* Немного уменьшен отступ */
      border: 1px solid var(--border-color);
      border-radius: 10px;
      text-align: center;
      font-size: 16px; /* Немного уменьшен размер шрифта */
      font-weight: 700;
      color: var(--primary-color); 
      margin-bottom: 15px;
    }

    /* MEDIA QUERIES - Vertical layout for smaller screens */
    @media (max-width: 700px) {
      .tool-container {
        flex-direction: column;
        gap: 0;
        max-width: 400px; /* Ограничим ширину для лучшего вида на мобильных */
      }
      .tool {
        max-width: 100%; 
        margin: 15px 0;
      }
    }
  </style>
</head>
<body>
  <div class="lang-selector">
    <button onclick="setLanguage('ru')"><img src="https://flagcdn.com/w40/ru.png" alt="RU">RU</button>
    <button onclick="setLanguage('en')"><img src="https://flagcdn.com/w40/us.png" alt="EN">EN</button>
    <button onclick="setLanguage('es')"><img src="https://flagcdn.com/w40/es.png" alt="ES">ES</button>
  </div>
  
  <div class="tool-container">
      <div class="tool">
        <h2 id="gmailTitle">Вариации почты Gmail</h2>
        <input type="text" id="emailInput" placeholder="Введите Gmail адрес, например dokyt56fg78@gmail.com" oninput="validateEmail()">
        <div id="emailError" class="error-message" style="display:none"></div>
        <div id="emailCounter" class="email-counter">Вариаций: 0</div>
        <div class="button-row">
          <button onclick="generateGmailVariations()" id="generateBtn">Сгенерировать</button>
          <button onclick="copyGmail()" id="copyBtn">Скопировать всё</button>
          <button onclick="downloadGmail()" id="downloadTxtBtn">Скачать .txt</button>
          <button onclick="downloadCSV()" id="downloadCsvBtn">Экспорт в CSV</button>
        </div>
        <textarea id="gmailOutput" placeholder="Здесь появятся варианты..." readonly></textarea>
      </div>

      <div class="tool">
        <h2 id="driveTitle">Прямая ссылка Google Диска</h2>
        <input type="text" id="driveInput" placeholder="Вставьте ссылку на файл в Google Диске">
        <div class="button-row">
          <button onclick="convertDriveLink()" id="convertBtn">Преобразовать</button>
          <button onclick="copyDrive()" id="copyDriveBtn">Скопировать ссылку</button>
          <button onclick="goToDriveLink()" id="goToLinkBtn">Перейти по ссылке</button>
          <button onclick="shortenDriveLink()" id="shortenLinkBtn">Укоротить ссылку</button>
        </div>
        <textarea id="driveOutput" placeholder="Прямая ссылка для скачивания" readonly></textarea>
      </div>
  </div>
  
  <script>
    // --- START: Existing Helper Functions (for XLSX, kept as is) ---
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
    // --- END: Existing Helper Functions ---

    const translations = {
      ru: {
        gmailTitle: "Вариации почты Gmail",
        generateBtn: "Сгенерировать",
        copyBtn: "Скопировать всё",
        downloadTxtBtn: "Скачать .txt",
        downloadCsvBtn: "Экспорт в CSV",
        driveTitle: "Прямая ссылка Google Диска",
        convertBtn: "Преобразовать",
        copyDriveBtn: "Скопировать ссылку",
        goToLinkBtn: "Перейти по ссылке",
        shortenLinkBtn: "Укоротить ссылку",
        emailCounter: "Вариаций: ",
        emailInputPlaceholder: "Введите Gmail адрес, например dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Здесь появятся варианты...",
        driveInputPlaceholder: "Вставьте ссылку на файл в Google Диске",
        driveOutputPlaceholder: "Прямая ссылка для скачивания",
        copySuccess: "Скопировано!",
        copyError: "Ошибка копирования: ",
        invalidEmailError: "Некорректный Gmail адрес",
        noGmailDataError: "Нет данных для сохранения.",
        noGmailExportError: "Нет данных для экспорта.",
        invalidDriveLinkError: "Не удалось извлечь ID файла. Проверьте правильность ссылки.",
        noDriveLinkError: "Нет ссылки для перехода. Сначала преобразуйте ссылку.",
        noLinkToShortenError: "Нет ссылки для укорачивания. Сначала преобразуйте ссылку.",
        shortenLinkError: "Ошибка при укорачивании ссылки. Проверьте API-ключ или обратитесь в поддержку T.LY."
      },
      en: {
        gmailTitle: "Gmail Address Variations",
        generateBtn: "Generate",
        copyBtn: "Copy All",
        downloadTxtBtn: "Download .txt",
        downloadCsvBtn: "Export to CSV",
        driveTitle: "Direct Google Drive Link",
        convertBtn: "Convert",
        copyDriveBtn: "Copy Link",
        goToLinkBtn: "Go to Link",
        shortenLinkBtn: "Shorten Link",
        emailCounter: "Variations: ",
        emailInputPlaceholder: "Enter Gmail address, e.g., dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Variations will appear here...",
        driveInputPlaceholder: "Paste the Google Drive file link",
        driveOutputPlaceholder: "Direct download link",
        copySuccess: "Copied!",
        copyError: "Copy error: ",
        invalidEmailError: "Invalid Gmail address",
        noGmailDataError: "No data to save.",
        noGmailExportError: "No data to export.",
        invalidDriveLinkError: "Failed to extract file ID. Check the link.",
        noDriveLinkError: "No link to navigate to. Convert the link first.",
        noLinkToShortenError: "No link to shorten. Convert the link first.",
        shortenLinkError: "Error shortening link. Check the API key or contact T.LY support."
      },
      es: {
        gmailTitle: "Variaciones de Gmail",
        generateBtn: "Generar",
        copyBtn: "Copiar todo",
        downloadTxtBtn: "Descargar .txt",
        downloadCsvBtn: "Exportar a CSV",
        driveTitle: "Enlace directo de Google Drive",
        convertBtn: "Convertir",
        copyDriveBtn: "Copiar enlace",
        goToLinkBtn: "Ir al enlace",
        shortenLinkBtn: "Acortar enlace",
        emailCounter: "Variaciones: ",
        emailInputPlaceholder: "Ingrese la dirección de Gmail, por ejemplo, dokyt56fg78@gmail.com",
        gmailOutputPlaceholder: "Las variaciones aparecerán aquí...",
        driveInputPlaceholder: "Pegue el enlace del archivo de Google Drive",
        driveOutputPlaceholder: "Enlace de descarga directa",
        copySuccess: "¡Copiado!",
        copyError: "Error al copiar: ",
        invalidEmailError: "Dirección de Gmail no válida",
        noGmailDataError: "No hay datos para guardar.",
        noGmailExportError: "No hay datos para exportar.",
        invalidDriveLinkError: "No se pudo extraer el ID del archivo. Verifique el enlace.",
        noDriveLinkError: "No hay enlace para navegar. Convierta el enlace primero.",
        noLinkToShortenError: "No hay enlace para acortar. Convierta el enlace primero.",
        shortenLinkError: "Error al acortar el enlace. Verifique la clave API o contacte con el soporte de T.LY."
      }
    };

    function setLanguage(lang) {
      document.documentElement.lang = lang;
      const t = translations[lang];
      document.getElementById("gmailTitle").innerText = t.gmailTitle;
      document.getElementById("generateBtn").innerText = t.generateBtn;
      document.getElementById("copyBtn").innerText = t.copyBtn;
      document.getElementById("downloadTxtBtn").innerText = t.downloadTxtBtn;
      document.getElementById("downloadCsvBtn").innerText = t.downloadCsvBtn;
      document.getElementById("driveTitle").innerText = t.driveTitle;
      document.getElementById("convertBtn").innerText = t.convertBtn;
      document.getElementById("copyDriveBtn").innerText = t.copyDriveBtn;
      document.getElementById("goToLinkBtn").innerText = t.goToLinkBtn;
      document.getElementById("shortenLinkBtn").innerText = t.shortenLinkBtn;
      const currentCount = document.getElementById("gmailOutput").value.split('\n').filter(Boolean).length;
      document.getElementById("emailCounter").innerText = t.emailCounter + currentCount;
      document.getElementById("emailInput").placeholder = t.emailInputPlaceholder;
      document.getElementById("gmailOutput").placeholder = t.gmailOutputPlaceholder;
      document.getElementById("driveInput").placeholder = t.driveInputPlaceholder;
      document.getElementById("driveOutput").placeholder = t.driveOutputPlaceholder;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage('ru');
    });

    async function copyToClipboard(text) {
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      try {
        await navigator.clipboard.writeText(text);
        alert(t.copySuccess);
      } catch (err) {
        alert(t.copyError + err);
      }
    }

    function validateEmail() {
      const emailField = document.getElementById("emailInput");
      const errorField = document.getElementById("emailError");
      const email = emailField.value.trim();
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      const localPart = email.split("@")[0];
      // Updated regex to handle the dot rule correctly based on Gmail's behavior (dots don't matter, but we check for general validity)
      const isValid = /^[a-zA-Z0-9]+(\.?[a-zA-Z0-9]+)*@gmail\.com$/.test(email) && /^(?!\.).*(?<!\.)$/.test(localPart) && !localPart.includes("..");
      
      if (email && !isValid) {
        emailField.classList.add("invalid");
        errorField.style.display = "block";
        errorField.innerText = t.invalidEmailError;
      } else {
        emailField.classList.remove("invalid");
        errorField.style.display = "none";
      }
    }

    function generateGmailVariations() {
      const email = document.getElementById("emailInput").value.trim().toLowerCase();
      const output = document.getElementById("gmailOutput");
      const counter = document.getElementById("emailCounter");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      output.value = "";
      
      const localPart = email.split("@")[0];
      const isValid = /^[a-zA-Z0-9]+(\.?[a-zA-Z0-9]+)*@gmail\.com$/.test(email) && /^(?!\.).*(?<!\.)$/.test(localPart) && !localPart.includes("..");
      
      if (!isValid) {
        validateEmail();
        counter.innerText = t.emailCounter + "0";
        return;
      }

      const local = email.split("@")[0].replace(/\./g, ''); // Remove all existing dots
      const variations = new Set();
      const positions = [];

      for (let i = 1; i < local.length; i++) positions.push(i);

      const totalCombos = Math.pow(2, positions.length);

      for (let i = 0; i < totalCombos; i++) {
        let parts = [], last = 0;
        for (let j = 0; j < positions.length; j++) {
          if (i & (1 << j)) {
            parts.push(local.slice(last, positions[j]));
            last = positions[j];
          }
        }
        parts.push(local.slice(last));
        const dotted = parts.join(".");
        
        // This final check ensures we don't accidentally create something invalid if the generation logic was flawed
        if (/^(?!\.).*(?<!\.)$/.test(dotted) && !dotted.includes("..")) {
          variations.add(dotted + "@gmail.com");
          variations.add(dotted + "@googlemail.com");
        }
      }

      const variationList = Array.from(variations).sort();
      output.value = variationList.join("\n");
      counter.innerText = t.emailCounter + variationList.length;
    }

    function copyGmail() {
      const text = document.getElementById("gmailOutput").value;
      copyToClipboard(text);
    }

    function downloadTextFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function downloadGmail() {
      const text = document.getElementById("gmailOutput").value;
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!text.trim()) {
        alert(t.noGmailDataError);
        return;
      }
      downloadTextFile("gmail_variations.txt", text);
    }

    function downloadCSV() {
      const text = document.getElementById("gmailOutput").value;
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (!text.trim()) {
        alert(t.noGmailExportError);
        return;
      }
      const lines = text.split('\n').filter(Boolean);
      const csvContent = "data:text/csv;charset=utf-8," 
                        + "Email Variation\n" 
                        + lines.map(line => `"${line}"`).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "gmail_variations.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function convertDriveLink() {
      const input = document.getElementById("driveInput").value.trim();
      const output = document.getElementById("driveOutput");
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      const match = input.match(/(?:\/d\/|id=|\/file\/d\/|drive\.google\.com\/(?:file\/d\/|open\?id=))([a-zA-Z0-9_-]{10,})/);
      if (match && match[1]) {
        const fileId = match[1];
        output.value = `https://drive.google.com/uc?export=download&id=${fileId}`;
      } else {
        output.value = "";
        alert(t.invalidDriveLinkError);
      }
    }

    function copyDrive() {
      const text = document.getElementById("driveOutput").value;
      copyToClipboard(text);
    }

    function goToDriveLink() {
      const link = document.getElementById("driveOutput").value.trim();
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      if (link) {
        window.open(link, '_blank');
      } else {
        alert(t.noDriveLinkError);
      }
    }

    // T.LY API key and functions are removed, but the original logic for shortening is kept in case the user changes their mind.
    const TLY_API_KEY = "Bearer RUqLv6yD7jSQIzEpmFjwTW9l440Q2H6LbTKuTq6J9cY0ZPwaTUw2tbcgLmeC";
    const TLY_API_URL = "https://t.ly/api/v1/link/shorten";

    async function shortenLink(longUrl, outputElementId) {
      const output = document.getElementById(outputElementId);
      const lang = document.documentElement.lang || 'ru';
      const t = translations[lang];
      output.value = ""; 
      
      if (!longUrl) {
          alert(t.noLinkToShortenError);
          return;
      }
      
      try {
        const online = navigator.onLine;
        if (!online) {
          throw new Error("Нет подключения к интернету. Проверьте сеть.");
        }

        const response = await fetch(TLY_API_URL, {
          method: "POST",
          headers: {
            "Authorization": TLY_API_KEY,
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({
            long_url: longUrl,
            domain: "https://t.ly/",
            include_qr_code: false
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Status: ${response.status}, Details: ${errorText}`);
        }

        const data = await response.json();
        output.value = data.short_url;
      } catch (error) {
        alert(t.shortenLinkError); 
      }
    }

    // This function remains to support the "Укоротить ссылку" button in the Drive tool
    async function shortenDriveLink() {
      const link = document.getElementById("driveOutput").value.trim();
      await shortenLink(link, "driveOutput");
    }

    // The function for TLY shortener tool is removed, as is the tool itself.
  </script>
</body>
</html>